<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<!-- local px-card -->
<link rel="import" href="/elements/px-card-view/px-card-view.html">

<dom-module id="px-deck">
  <template>

    <iron-ajax
      id="deckIronAjax"
      url="[[_deckUrl]]"
      last-response="{{_deckData}}"
      auto>
    </iron-ajax>

    <template is="dom-repeat" items="[[_cards]]">
      <px-card-view card-data="[[item]]"></px-card-view>
    </template>

  </template>
  <script>
    Polymer({

      is: 'px-deck',

      properties: {
        // set by parent
        deckId: {
          type: String
        },
        viewServiceBaseUrl: {
          type: String,
          value: '/api/view-service/' // default
        },
        // set on initialzation
        _decksUrl: {
          type: String,
          computed: '_computeDecksUrl(viewServiceBaseUrl)'
        },
        // updated when deckId is changed
        _deckUrl: {
          type: String,
          computed: '_computeDeckUrl(_decksUrl, deckId)'
        },
        // returned from iron-ajax request
        _deckData: {
          type: Object,
          value: function() { return {}; }
        },
        // cards: [{card},{card}] updated on _deckData change
        _cards: {
          type: Array,
          value: function() { return []; }
        }
      },

      observers: [
        '_setCards(_deckData)'
      ],

      _computeDeckUrl: function() {
        // Set Url of iron-ajax element, triggering request and update of _lastDeck
        return this._decksUrl + this.deckId;
      },

      _computeDecksUrl: function() {
        return this.viewServiceBaseUrl + 'decks/';
      },

      _setCards: function() {
        if(typeof this._deckData !== 'undefined') {
          this.set('_cards', this._deckData.cards || []);
        }
      }

    });
  </script>
</dom-module>
