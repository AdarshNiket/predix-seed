<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="px-user-model">

  <template>
    <h1>Px User Model</h1>
    <br />
    <ul>
      <li>isAuthenticated: {{isAuthenticated}}</li>
    </ul>
    <iron-ajax
      auto
      url="/userinfo.json"
      handle-as="json"
      on-response="handleAjaxResponse"
      last-response="{{response}}"
      ></iron-ajax>

  </template>

  <script>
    Polymer({

      is: 'px-user-model',

      properties: {
        isAuthenticated: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true,
          readOnly: true
        }
      },

      ready: function() {

      },

      handleAjaxResponse: function(e,a,b,c) {
        console.log('handleAjaxResponse', e,a,b,c);
        // console.log(a.response);
      },

      getIsAuthenticated: function() {
          return this.getUserInfo();
      },

      login: function(uiState) {
          window.px.auth.login(uiState);
      },

      getUserInfo: function() {
          var deferred = $q.defer();
          window.px.auth.getUserInfo().then(function(userInfo) {
              deferred.resolve(userInfo);
          }, function() {
              deferred.reject();
          });
          return deferred.promise;
      }

    });
  </script>

</dom-module>
