<link rel="import" href="../../bower_components/polymer/polymer.html">
<!-- the px-view component does two things: -->
<!-- conditionally show/hide content -->
<!-- conditionally load content -->
<dom-module id="px-view">
  <template>
    <!-- view element will be inserted here -->
  </template>
  <script>
    Polymer({

      is: 'px-view',

      properties: {
        preload: {
          type: Boolean,
          value: false
        },
        status: {
          type: String,
          observer: '_checkStatus',
          value: 'unloaded' // unloaded -> loading -> loaded -> attached
        },
        visible: {
          type: Boolean,
          computed: '_computeVisible(route, match, status)',
          observer: '_checkVisible'
        },
        route: {
          type: String,
          observer: '_checkRoute',
          value: ""
        },
        tag: {
          type: String,
          value: ""
        },
        match: {
          type: String,
          value: ""
        },
        url: {
          type: String,
          value: ""
        }
      },

      viewElement: null, // reference to the loaded view element

      ready: function() {
        this._initializeView();
      },

      _initializeView: function() {
        if(this.tag !== null) {
          if(this.preload) {
            this._loadElement();
          };
          this._checkRoute();
        } else {
          // call back when the component is truly ready
          this.async(function() {
            this._initializeView();
          }, null, 500);
        };
      },

      // unloaded -> loading -> loaded -> attached
      _checkStatus: function(newValue) {
        switch (newValue) {
          case 'unloaded':

            break;
          case 'loading':

            break;
          case 'loaded':
            if(this.match === this.route) {
              this._attachElement();
            };
            break;
          case 'attached':

            break;
          default:

        }
      },

      _checkRoute: function(newValue) {
        // this route is route
        // console.log(this.match);
        if(this.match === this.route) {
          if(this.tag) {
            console.group();
              console.log('is match?   ', this.match === this.route);
              console.log('new Value:  ', newValue );
              console.log('app.route:  ', app.route);
              console.log('this.match: ', this.match);
              console.log('this.route: ', this.route);
              console.log('this.tag:   ', this.tag);
            console.groupEnd();
            if(this.status === 'loaded') {
              
            };
            this._attachElement();
          };
        } else {
          this.set('visible', false);
        };
      },

      _computeVisible: function(route, match, status) {
        return (route === match && status === 'attached');
      },

      // observer to visible, set style.display of viewElement
      _checkVisible: function(visible) {
        if(this.status === 'attached') {
          this.viewElement.style.display = visible ? "block" : "none";
        };
      },

      _attachElement: function() {
        this.viewElement = document.createElement(this.tag);
        this.appendChild(this.viewElement);
        this.status = 'attached';
      },

      _loadElement: function() {
        if(this.status === 'unloaded' && typeof this.url !== 'undefined') {
          this.importHref(this.url, function(e) {
            this.status = 'loaded';
          }, function(e) {
            console.log('failure to load ' + this.url, e);
          });
          this.status = 'loading';
        };
      }

    });
  </script>
</dom-module>
