<link rel="import" href="../../bower_components/polymer/polymer.html">
<!-- this element does two things: -->
<!-- conditionally show/hide content -->
<!-- conditionally load content -->
<dom-module id="px-view">
  <template>
    <!-- view element will be inserted here -->
  </template>
  <script>
    Polymer({

      is: 'px-view',

      properties: {
        preload: {
          type: Boolean,
          value: false
        },
        status: {
          type: String,
          // observer: '_checkRoute',
          value: 'unloaded' // unloaded -> loading -> loaded -> attached
        },
        visible: {
          type: Boolean,
          observer: '_checkVisibility',
          value: false
        },
        route: {
          type: String,
          observer: '_checkRoute',
          value: ""
        },
        element: {
          type: Object,
          value: null
        },
        tag: {
          type: String,
          value: ""
        },
        match: {
          type: String,
          value: ""
        },
        url: {
          type: String,
          value: ""
        }
      },

      ready: function() {
        this._initializeView();
      },

      _initializeView: function() {
        if(this.tag !== null) {
          if(this.preload) {
            this._loadElement();
          };
          this._checkRoute();
        } else {
          // call back when the component is truly ready
          this.async(function() {
            this._initializeView();
          }, null, 500);
        };
      },

      _checkRoute: function(newValue) {

        console.group();
          console.log('new Value:', newValue );
          console.log('app.route', app.route);
          console.log('this.match: ', this.match);
          console.log(', this.route: ', this.route);
          console.log(', this.tag: ', this.tag);
          console.log(app);
        console.groupEnd();

        // this route is route
        // console.log(this.match);
        if(this.match === this.route) {
          if(this.tag) {
            console.log('tag yo', this.tag)
            this.visible = true;
            this._attachElement();
          };
        } else {
          this.visible = false;
        };
      },

      _checkVisibility: function() {
        if(this.visible === true && this.element !== null && this.status === 'attached') {
          this.element.style.display = "block";
        } else if(this.element !== null && this.status === 'attached'){
          this.element.style.display = "none";
        }
      },

      _attachElement: function() {
        if(this.status === 'loaded') {
          this.element = document.createElement(this.tag); // <home-view>
          this.appendChild(this.element);
          this.status = 'attached';
          this._checkVisibility();
        } else if(this.status !== 'attached') {
          this._loadElement();
        };
      },

      _loadElement: function() {
        if(this.status === 'unloaded' && typeof this.url !== 'undefined') {
          this.importHref(this.url, function(e) {
            this.status = 'loaded';
          }, function(e) {
            console.log('failure to load ' + this.url, e);
          });
          this.status = 'loading';
        };
      }

    });
  </script>
</dom-module>
