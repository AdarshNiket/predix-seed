<link rel="import" href="../../bower_components/polymer/polymer.html">
<!-- this element does two things: -->
<!-- conditionally show/hide content -->
<!-- conditionally load content -->
<dom-module id="px-view">
  <template>
    <!-- element will be inserted here -->
  </template>
  <script>
    Polymer({

      is: 'px-view',

      properties: {
        preload: {
          type: Boolean,
          value: false
        },
        status: {
          type: String,
          observer: '_checkStatus',
          value: 'unloaded' // unloaded -> loading -> loaded -> attached
        },
        visible: {
          type: Boolean,
          observer: '_checkVisibility',
          value: false
        },
        selected: {
          type: String,
          observer: '_checkRoute',
          value: null
        },
        route: String,
        tag: String,
        url: String,
        element: {
          type: Object,
          value: null
        }
      },

      ready: function() {
        if(this.preload === true) {
          this._loadElement();
        };
        this._checkRoute();
      },

      _checkRoute: function() {
        // this route is selected
        if(this.route === this.selected) {
          this.visible = true;
          this._attachElement();
        };
      },

      _checkVisibility: function() {
        if(this.visible === true && this.element !== null && this.status === 'attached') {
          this.element.style.display = "block";
        } else if(this.element !== null && this.status === 'attached'){
          this.element.style.display = "none";
        }
      },

      _attachElement: function() {
        if(this.status === 'loaded') {
          this.element = document.createElement(this.tag);
          this.appendChild(this.element);
          this.status = 'attached';
          this._checkVisibility();
        } else if(this.status !== 'attached') {
          this._loadElement();
        };
      },

      _loadElement: function() {
        if(this.status === 'unloaded') {
          this.importHref(this.url, function(e) {
            this.status = 'loaded';
          }, function(e) {
            console.log('failure to load ' + this.url, e);
          });
          this.status = 'loading';
        };
      },

      _checkStatus: function() {
        switch(this.status) {
          case 'attached':
            console.log(this.tag + ' attached');
            // element is attached
            break;
          case 'loaded':
            console.log(this.tag + ' loaded');
            this._attachElement();
            break;
          case 'loading':
            // loading
            console.log(this.tag + ' loading');
            break;
          case 'attached':

          default:
            console.log('default');
        }
      }

    });
  </script>
</dom-module>
