<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="/bower_components/px-card/px-card.html" />
<link rel="import" href="/bower_components/px-data-table/px-data-table.html" />

<dom-module id="data-table-card">
  <template>
    <px-card header-text="Datagrid">
      <iron-ajax
        id="dataTableDataIronAjax"
        url="[[_ajaxURL]]"
        last-response="{{_ajaxData}}"
        auto>
      </iron-ajax>
      <px-data-table filterable selectable table-data="{{_dataTableData}}"></px-data-table>
    </px-card>
  </template>
</dom-module>
<script>
  Polymer({

    is: 'data-table-card',

    properties: {
      elementData: {
        type: Object,
        value: function() { return { 'empty': true }; }
      },
      _ajaxURL: {
        type: String,
        computed: '_computeAjaxURL(elementData)'
      },
      _ajaxData: {
        type: Object
      },
      _dataTableData: {
        type: Object,
        computed: '_computeDataTableData(_ajaxData)'
      }
    },

    _computeDataTableData: function(){
      return this._ajaxData['data'];
    },

    _computeAjaxURL: function() {
      console.log(this.elementData.attributes);
      if(this.elementData !== { 'empty': true } &&
         typeof this.elementData.attributes !== 'undefined') {
        console.log(this.elementData)
        return this.elementData.attributes.dataUrl;
      }
    }

  });
</script>
