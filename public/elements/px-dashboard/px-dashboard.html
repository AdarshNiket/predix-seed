<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="px-dashboard">
  <template>
    <script src="../../bower_components/lodash/lodash.js"></script>
    <!-- Deck -->
    <iron-ajax id="deckIronAjax"
      last-response="{{_lastDeck}}" auto></iron-ajax>
    <br/>
    [[_lastDeck]]
  </template>
</dom-module>
<script>
  Polymer({

    is: 'px-dashboard',

    properties: {
      selectedDeckId: {
        type: String
      },
      viewServiceBaseUrl: {
        type: String,
        value: 'http://localhost:8181/api/view-service/'
      },
      _lastDeck: {
        type: Object,
        observer: '_lastDeckChanged'
      },
      _decks: {
        type: Array,
        computed: '_computeDecks(decksResponse)'
      },
      _viewServiceDecksUrl: {
        type: String,
        computed: '_computeViewServiceDecksUrl(viewServiceBaseUrl)'
      },
      _viewServiceCardsUrl: {
        type: String,
        computed: '_computeViewServiceCardsUrl(viewServiceBaseUrl)'
      }
    },

    observers: [
      '_selectedDeckIdChanged(selectedDeckId, _viewServiceDecksUrl)'
    ],

    _selectedDeckIdChanged: function() {
      // Set Url of iron-ajax element, triggering request and update of _lastDeck
      if(_.isString(this.selectedDeckId)) {
        this.$.deckIronAjax.url = this._viewServiceDecksUrl + this.selectedDeckId;
      }

    },

    _lastDeckChanged: function() {
      console.log('_lastDeckChanged');
      console.log(this._lastDeck);
    },

    _computeViewServiceDecksUrl: function() {
      return this.viewServiceBaseUrl + 'decks/';
    },

    _computeViewServiceCardsUrl: function() {
      return this.viewServiceBaseUrl + 'cards/';
    }

  });
</script>
