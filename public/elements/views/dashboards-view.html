<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/px-deck-selector/px-deck-selector.html">
<link rel="import" href="../../bower_components/px-card/px-card.html">

<!-- local px-deck -->
<link rel="import" href="../../elements/px-deck/px-deck-index.html">

<dom-module id="dashboards-view">
  <template>

    <script type="text/javascript" src="../../bower_components/es6-promise/es6-promise.min.js"></script>

    <px-card header-text="Select View">
      <px-deck-selector
        id="deckSelector"
        decks="[[_decks]]"
        selected-deck="{{_selectedDeck}}">
      </px-deck-selector>
    </px-card>
    <px-deck-index
      id="deckIndex"
      decks="[[_decks]]"
      deck-id="[[_selectedDeckId]]">
    </px-deck-index>

  </template>
  <script>
    Polymer({

      is: 'dashboards-view',

      properties: {
        _decks: {
          type: Array,
          value: [
          {
            "id": 1,
            "name": "Overview",
            "slug": "overview",
            "cards": [
              {
                "id": 1,
                "title": "seed-intro-card",
                "slug": "seed-intro-card",
                "attributes": {
                  "elementHref": "/elements/seed-intro-card/seed-intro-card.html"
                },
                "createTimeStamp": "2015-11-24T23:02:53.816Z",
                "tags": []
              },
              {
                "id": 2,
                "title": "Three widgets card",
                "slug": "three-widgets-card",
                "attributes": {
                  "elementHref": "/elements/three-widgets-card/three-widgets-card.html"
                },
                "createTimeStamp": "2015-11-24T23:02:53.816Z",
                "tags": []
              }
            ],
            "cardOrder": null,
            "createTimeStamp": "2015-11-24T23:02:53.838Z",
            "tags": [{
              "id": 1,
              "value": "parent-asset"
            }]
          },
          {
            "id": 2,
            "name": "Data Table View",
            "slug": "data-table-view",
            "cards": [
              {
                "id": 3,
                "title": "Data Table Card",
                "slug": "data-table-card",
                "attributes": {
                  "elementHref": "/elements/data-table-card/data-table-card.html",
                  "dataUrl": "/api/time-series/datagrid/1",
                  "headerText": "HRSG Unit Data"
                },
                "createTimeStamp": "2015-11-24T23:02:53.816Z",
                "tags": []
              }
            ],
            "cardOrder": null,
            "createTimeStamp": "2015-11-24T23:02:53.838Z",
            "tags": [{
              "id": 2,
              "value": "parent-asset"
            }]
          },
          {
            "id": 3,
            "name": "Detail View",
            "slug": "detail-view",
            "cards": [
              {
                "id": 4,
                "title": "Time Series",
                "slug": "time-series-card",
                "attributes": {
                  "elementHref": "/elements/time-series-card/time-series-card.html",
                  "dataUrl": "/api/time-series/core-vibe/1"
                },
                "createTimeStamp": "2015-11-24T23:02:53.816Z",
                "tags": []
              }
            ],
            "cardOrder": null,
            "createTimeStamp": "2016-08-31T23:02:53.838Z",
            "tags": [{
              "id": 3,
              "value": "child-asset"
            }]
          }
          ]
        },
        _selectedDeckId: {
          type: String,
          computed: '_computeSelectedDeckId(_selectedDeck)'
        }
      },

      observers: [
        '_updateDecks(_selectedDeck)'
      ],

      _computeSelectedDeckId: function() {
        if(this._selectedDeck) {
          return this._selectedDeck.id;
        }
      },

      _updateDecks() {
        console.log(this._selectedDeck);
        this._selectedDeckId = this._computeSelectedDeckId();
        console.log(this._selectedDeckId);
      },

      ready: function ready() {
        var _this = this;
        this.$.deckIndex._decks = this._decks;
      }

    });
  </script>
</dom-module>
